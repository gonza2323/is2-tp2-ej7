<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nuevo Libro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div th:replace="~{fragments/header :: navbar}"></div>

<main class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h1 class="h5 mb-0">Registrar libro</h1>
                </div>
                <div class="card-body">
                    <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>

                    <form th:action="@{/libros/guardar}" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="isbn" class="form-label">ISBN</label>
                                <input type="number" id="isbn" name="isbn" class="form-control" th:value="${libro.isbn}" min="1" required>
                                <div class="invalid-feedback">El ISBN es obligatorio.</div>
                            </div>
                            <div class="col-md-8">
                                <label for="titulo" class="form-label">Título</label>
                                <input type="text" id="titulo" name="titulo" class="form-control" th:value="${libro.titulo}" placeholder="Ej: Rayuela" required>
                                <div class="invalid-feedback">El título es obligatorio.</div>
                            </div>
                            <div class="col-md-4">
                                <label for="anio" class="form-label">Año</label>
                                <input type="number" id="anio" name="anio" class="form-control" th:value="${libro.isbn != null ? libro.anio : ''}" min="0" required>
                                <div class="invalid-feedback">Ingrese un año válido.</div>
                            </div>
                            <div class="col-md-4">
                                <label for="ejemplares" class="form-label">Ejemplares</label>
                                <input type="number" id="ejemplares" name="ejemplares" class="form-control" th:value="${libro.isbn != null ? libro.ejemplares : ''}" min="0" required>
                                <div class="invalid-feedback">Ingrese la cantidad de ejemplares.</div>
                            </div>
                            <div class="col-md-4">
                                <label for="ejemplaresPrestados" class="form-label">Prestados</label>
                                <input type="number" id="ejemplaresPrestados" name="ejemplaresPrestados" class="form-control" th:value="${libro.isbn != null ? libro.ejemplaresPrestados : ''}" min="0">
                            </div>
                            <div class="col-md-4">
                                <label for="ejemplaresRestantes" class="form-label">Disponibles</label>
                                <input type="number" id="ejemplaresRestantes" name="ejemplaresRestantes" class="form-control" th:value="${libro.isbn != null ? libro.ejemplaresRestantes : ''}" min="0">
                            </div>
                            <div class="col-md-4">
                                <label for="autorId" class="form-label">Autor</label>
                                <select id="autorId" name="autorId" class="form-select" required>
                                    <option value="" disabled th:if="${autorSeleccionado == null}" th:selected="${autorSeleccionado == null}">Seleccione un autor</option>
                                    <option th:each="autor : ${autores}"
                                            th:value="${autor.id}"
                                            th:text="${autor.nombre}"
                                            th:selected="${autorSeleccionado != null ? autor.id == autorSeleccionado : (libro.autor != null ? autor.id == libro.autor.id : false)}">
                                    </option>
                                </select>
                                <div class="invalid-feedback">Seleccione un autor.</div>
                            </div>
                            <div class="col-md-4">
                                <label for="editorialId" class="form-label">Editorial</label>
                                <select id="editorialId" name="editorialId" class="form-select" required>
                                    <option value="" disabled th:if="${editorialSeleccionada == null}" th:selected="${editorialSeleccionada == null}">Seleccione una editorial</option>
                                    <option th:each="editorial : ${editoriales}"
                                            th:value="${editorial.id}"
                                            th:text="${editorial.nombre}"
                                            th:selected="${editorialSeleccionada != null ? editorial.id == editorialSeleccionada : (libro.editorial != null ? editorial.id == libro.editorial.id : false)}">
                                    </option>
                                </select>
                                <div class="invalid-feedback">Seleccione una editorial.</div>
                            </div>
                            <div class="col-md-8">
                                <label for="archivo" class="form-label">Portada</label>
                                <input type="file" id="archivo" name="archivo" class="form-control" accept="image/*">
                            </div>
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="alta" value="false">
                                    <input class="form-check-input" type="checkbox" id="alta" name="alta" value="true" th:checked="${libro.alta}">
                                    <label class="form-check-label" for="alta">Libro activo</label>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a class="btn btn-outline-secondary" th:href="@{/libros/listar}">Volver</a>
                            <button type="submit" class="btn btn-primary">Guardar libro</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
